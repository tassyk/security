---
Title: Pentest Labs
Type: Doc
Nature: Notes
Création: 15/05/2020
---

#  Web pentest Labs
---
**Sommaire**

- **[Vuln box](#Vuln-box)**
- **[Mise en place des applications vulnérables](#Mise-en-place-des-applications-vulnérables)**
  - [Installation from source](#Installation-from-source)
    - [Prerequis](#Prerequis)
    - [Installation de DVWA](#Installation-de-DVWA)
    - [Installation de bWAPP](#Installation-de-bWAPP)
    - [Installation d'OWASP Mullitidae](#Installation-d'OWASP-Mullitidae)
    - [Installation d'OWASP Juice Shop](#Installation-d'OWASP-Juice-Shop)
  - [Installation via Docker](#Installation-via-Docker)
- **[Mise en place des VM vulnérables](#Mise-en-place-des-VM-vulnérables)**
- **[Outils de pentest](#Outils-de-pentest)**
- **[Pour aller plus loin](#Pour-aller-plus-loin)**
- **[Liens](#Liens)**
---

##  Vuln box
- Applications vulnérables :
  - [DVWA](http://www.dvwa.co.uk/) : Application web PHP/Mysql vulnérable
  - [bWAPP](www.itsecgames.com) : Application web PHP/Mysql vulnérable
  - [OWASP Mutillidae](https://sourceforge.net/projects/mutillidae/) : Application vulnérable d'OWASP
  - [OWASP Juice Shop](https://owasp.org/www-project-juice-shop/) : Application vulnerable développée en Node.js, Express et Angular
  - [BodgIT](https://github.com/psiinon/bodgeit) : Application java vulnerable application
  - [vulnweb](http://www.vulnweb.com/) : Site web vulnérable en ligne (for Acunetix Web Vulnerability Scanner)
-  VM vulnérables :
  - [Metasploitable3](https://github.com/rapid7/metasploitable3) : Linux vulnerable VM
  -  [Metasploitable2](https://metasploit.help.rapid7.com/docs/metasploitable-2) : Linux vulnerable VM
  - [bee-box](https://sourceforge.net/projects/bwapp/files/bee-box/) :  VM linux preconfiguré avec bWAPP
  - [vulnhub](https://www.vulnhub.com/) : Vulnerable test VM
  - [Hack The box](https://www.hackthebox.eu/) : VM vulnérables
  - [vulnarable-AD](https://github.com/WazeHell/vulnerable-AD) : AD vulnérable pour test.

## Mise en place des applications vulnérables
> La plupart de ces applications vulnérables peuvent être installées from source ou via Docker.

### Installation from source
#### Prerequis
Prerequis pour les installations `from source` des applications basées sur PHP/Mysql:
- Installation des paquets nécessaires : `git, wget`
```
sudo yum install -y git wget
```
- Installation de Httpd, PHP/Mysql
```
# apache
sudo yum install httpd
sudo systemctl start httpd
sudo systemctl enable httpd
# php et modules  
sudo yum install php php-common php-gd php-mbstring php-mysql php-pdo # php-54 (from remi-ph54 repo)
# mysql/mariadb
sudo yum install -y mariadb-server mariadb # mariadb55 (from base repo)
sudo systemctl start mariadb
sudo systemctl enable mariadb
#sudo mysql_secure_installation # pour sécuriser la base de données
```
- Création de la base de données pour l'application
```
mysql -u root -p
MariaDB [(none)]> create database applidb;
MariaDB [(none)]> create user appliuser@localhost identified by 'applipass';
MariaDB [(none)]> grant all on applidb.* to appliuser@localhost identified by 'applipass';
MariaDB [(none)]> flush privileges;
MariaDB [(none)]> quit
```
> noms DB, user et pass à adapeter en fonction de l'application

Prerequis pour les installations `from source` des applications basées Nodejs :
- Update packages
```
sudo yum update -y
sudo yum install -y yum-utils
sudo yum-complete-transaction
```
- installer Nodejs
```
sudo curl -sL https://rpm.nodesource.com/setup_14.x | bash -
sudo yum install -y nodejs
##  development tools to build native addons:
sudo yum install gcc-c++ make
## install the Yarn package manager, run:
sudo curl -sL https://dl.yarnpkg.com/rpm/yarn.repo | sudo tee /etc/yum.repos.d/yarn.repo
sudo yum install yarn
```

#### Installation de DVWA
[DVWA](http://www.dvwa.co.uk/) est application web PHP/Mysql vulnérable. Elle peut être installée comme suit :
- clone du dépôt git de l'application
```
cd /var/www/html
git clone https://github.com/ethicalhack3r/DVWA.git
sudo mv DVWA dvwa
sudo chmod -R 777 dvwa
```
- configuration de la base de données : voir prerequis

- configuration de php
```
$ cat /etc/php.ini
allow_url_fopen = On # Allows for Remote File Inclusions (RFI)
allow_url_include = On # Allows for Remote File Inclusions (RFI)
display_errors = Off # (Optional) Hides PHP warning messages to make it less verbose
```
- configuration de DVWA
```
sudo cp dvwa/config/config.inc.php.dist dvwa/config/config.inc.php
# adapter les info du fichier dvwa/config/config.inc.php
$_DVWA[ 'db_server' ]   = '127.0.0.1';
$_DVWA[ 'db_database' ] = 'dvwadb';
$_DVWA[ 'db_user' ]     = 'dvwauser';
$_DVWA[ 'db_password' ] = 'p@ssw0rd';
# clé recaptcha (à créer sur: https://www.google.com/recaptcha/admin)
$_DVWA[ 'recaptcha_public_key' ]  = 'recaptcha_public_key';
$_DVWA[ 'recaptcha_private_key' ] = 'recaptcha_private_key';
```
- Finalisation de la configuration via l'interface web : http://IP_server/dvwa/setup.php
> Corriger les erreurs s'il y en a
> Cliquer sur Create/Reset database
> Login : admin/password

#### Installation de bWAPP
[bWAPP](https://sourceforge.net/projects/bwapp/) est application web PHP/Mysql vulnérable. Elle fait partie du projet [ITSEC GAMES](www.itsecgames.com). Elle peut être [installée](http://itsecgames.blogspot.com/2013/01/bwapp-installation.html) comme suit :
- Télécharger l'archive de l'application
```
sudo wget https://sourceforge.net/projects/bwapp/files/latest/download
```
- décompresser le paquet et définir les permissions
```
cd /var/www/html
sudo unzip download -d bwapp
sudo chmod -R 777 bwapp/bWAPP/passwords/
sudo chmod 777 bwapp/bWAPP/images/
```
- configuration de la base de données : voir prerequis
> Attention: ne pas créer de base de données. bWAPP utilise bWAPP comme nom de base de données par défaut

- Adapter les paramètres
```
$ cat bwapp/bWAPP/admin/settings.php
// Database connection settings
$db_server = "localhost";
$db_username = "bwapp";
$db_password = "bwapp";
$db_name = "bWAPP";
```
- Finalisation de l'installation via l'interface web : http://IP_server/bwapp/bWAPP/install.php
> Cliquer sur le bouton `here`
> Sur la page de login, entrer `bee/bug` pour s'authentifier.

#### Installation d'OWASP Mullitidae
[OWASP Mullitidae](https://github.com/webpwnized/mutillidae) est application web PHP/Mysql vulnérable comportant les dernières vulnérabilités du top 10 d'OWASP. Elle peut être [installée](http://itsecgames.blogspot.com/2013/01/bwapp-installation.html) comme suit :

- Cloner le dépôt Github du projet
```
cd /var/www/html
sudo git clone https://github.com/webpwnized/mutillidae.git
```
- configuration de la base de données : voir prerequis
> Note seul la création de la BD est requise. Le user est optionnel

- définition des permissions
```
sudo chmod -R 777 mutillidae
```
- (optionnel) adaptation des paramètres de la base de données dans `mutillidae/classes/MySQLHandler.php`
```
static public $mMySQLDatabaseUsername = DB_USERNAME;
static public $mMySQLDatabasePassword = DB_PASSWORD;
static public $mMySQLDatabaseName = DB_NAME;
```
> A faire, si on souhaite changer les paramètres de la base de données

- Finalisation de l'installation via l'interface web : http://IP_server/mutillidae
> Cliquer sur le bouton `Opt out` puis sur `setup/reset the DB`
> Explorer les challenges et apprécier!

#### Installation d'OWASP Juice Shop
[OWASP Juice Shop](https://owasp.org/www-project-juice-shop/) est application Javascript vulnérable développée en [Node.js](https://nodejs.org/en/), Express et Angular. Elle peut être [installée](https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions-enterprise-linux-fedora-and-snap-packages) comme suit :

- Installation de Nodejs : voir prérequis (pour nodejs)
> See : [installation Nodejs](https://www.server-world.info/en/note?os=CentOS_7&p=nodejs)
> Versions [nodejs supportées](https://github.com/bkimminich/juice-shop#nodejs-version-compatibility) : 10.x, 12.x and 14.x of Node.js

- Cloner le dépôt Github de l'application
```
su -
cd /var/www/html
git clone https://github.com/bkimminich/juice-shop.git
```
- Installer et démarrer l'application
```
chmod -R 777 juice-shop
cd juice-shop
npm install
npm start
```
> Note :
> - à installer en tant que `root` pour éviter les problèmes : `sudo su`
> - Correction erreur relative à `gyp ERR!`, essayer `npm install -g node-gyp`

- Connexion à l'interface web : http://IP_server:3000

### Installation via Docker
Si vous rencontrez des problèmes pour installer les versions "form source", vous pouvez installer les versions Docker :
- [DVWA Docker](https://hub.docker.com/r/vulnerables/web-dvwa/)
- [Mutillidae Docker](https://hub.docker.com/r/citizenstig/nowasp/)
- [OWASP bWapp](https://hub.docker.com/r/feltsecure/owasp-bwapp/)
- [Juice Shop Docker Container](https://github.com/bkimminich/juice-shop#docker-container)
- [WebGoat Docker](https://github.com/WebGoat/WebGoat)

## Mise en place des VM vulnérables
Outre les applications vulnérables, il existe aussi des VM vulnérables. Nous n'allons pas montrer comment les mettre en place, car c'est relativement simpleElles de les intégrer dans Vmware workstation, Virtualbox, Proxmox, ...

Voici une liste non exaustive des VM vulnérables :
- [Metasploitable3](https://github.com/rapid7/metasploitable3) : Linux vulnerable VM
- [Metasploitable2](https://metasploit.help.rapid7.com/docs/metasploitable-2) : Linux vulnerable VM
> Note : Les Metasploitable sont des VM vulnérables. Elles sont préconfigurées avec des services vulnérables comme Mutillidae,  DVWA, ftp, ... Metasploitable3 se déploie via Vagrant et existe aussi en version Windows, tandis que Metasploitable2 n'existe qu'en version Linux.

- [bee-box](https://sourceforge.net/projects/bwapp/files/bee-box/) :  VM linux preconfigurée avec bWAPP

## Outils de pentest
- Machines d'attaques :
  - [Kali Linux](https://www.kali.org/) : VM Linux avec des outils de pentest préconfiguré
  - [Parrot Linux](https://parrotlinux.org/) : VM Linux avec des outils de pentest préconfiguré
- Scan de port :
  - [Nmap](https://nmap.org/)
  - [Nessus](https://fr.tenable.com/products/nessus)
  - [Openvas](https://www.openvas.org/)
- Vulnérabilité web :
  - [Nikto]() : détecte les vulnérabilités sur une application web
  - [SqlMap](http://sqlmap.org/) : détecter des vulnérabilités liées aux injections SQL et les tester
  - [Burp suite](https://portswigger.net/burp) : proxy web pour intercepter les requêtes, les modifier, faire du fuzzin, ...

## Pour aller plus loin
Pour aller plus loin dans son apprentissage de Pentest, il existe des plateformes d'entrainement en ligne, comme :
- [Rootme](https://www.root-me.org/)
- [CTFTime](https://ctftime.org/ctfs)
- [vulnhub](https://www.vulnhub.com/)
- [Hack The box](https://www.hackthebox.eu/)
- [Incident Response Challenges](https://incident-response-challenge.com/?utm_source=thn)

Elles présentatnt des épreuves (challenge) à résoudre. Il y en une multitude sur Internet. Je vous laisse le soin de les explorer.

Il existe aussi des writeups (corrections) sur certains CTF, qui peuvent aider aussi :
- [writeups ctftime](https://ctftime.org/writeups)
- [topics ctf-writeups Github](https://github.com/topics/ctf-writeups)

## Liens
- Documentations :
  - [Pwning OWASP Juice Shop](https://pwning.owasp-juice.shop/)
  - [Juice shop demo](http://demo.owasp-juice.shop/#/)
  - [Node.js](https://nodejs.org/en/)
- Tutorials
  - [DVWA sous centos](https://kifarunix.com/install-and-setup-dvwa-on-centos-8/)
  - [bWAPP sous Kali](https://www.kalilinux.in/2020/02/bwapp-in-kali-linux-2020.html)
  - [Mutillidae installation](https://pycycle.info/2016/how-to-setup-mutillidae.html)
  - [Juice Shop installation from source](https://github.com/bkimminich/juice-shop#from-sources)
- Challenges
  - [Incident Response Challenges](https://incident-response-challenge.com/?utm_source=thn)
  - [Rootme](https://www.root-me.org/)
  - [CTFTime](https://ctftime.org/ctfs)
  - [vulnhub](https://www.vulnhub.com/)
  - [Hack The box](https://www.hackthebox.eu/)
  - [Practice CTF List](https://captf.com/practice-ctf/)
  - [writeups ctftime](https://ctftime.org/writeups)
  - [topics ctf-writeups Github](https://github.com/topics/ctf-writeups)
- Learning :
  - [Burp suit websecurity academy](https://portswigger.net/web-security)
  - [Hackingarticles.in](https://www.hackingarticles.in/)
  - [Privilege Escalation Cheatsheet (Vulnhub)](https://github.com/Ignitetechnologies/Privilege-Escalation#table-of-contents)
  - [Hacking Techniques by MITTRE](https://attack.mitre.org/techniques/enterprise/)
  - [BodgeIT Docker](https://hub.docker.com/r/psiinon/bodgeit)

